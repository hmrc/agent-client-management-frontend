@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import org.joda.time.LocalDate
@import play.api.Configuration
@import uk.gov.hmrc.agentclientmanagementfrontend.config.ExternalUrls
@import uk.gov.hmrc.agentclientmanagementfrontend.controllers.routes
@import uk.gov.hmrc.agentclientmanagementfrontend.views.AuthorisedAgentsPageConfig
@(config: AuthorisedAgentsPageConfig)(implicit messages: Messages, request: Request[_], configuration: Configuration, externalUrls: ExternalUrls, now: LocalDate)

@uk.gov.hmrc.agentclientmanagementfrontend.views.html.main_template(title = Messages("client-authorised-agents.title"), bodyClasses = Some("full-width")){

    <h1 class="heading-large">@Messages("client-authorised-agents.title")</h1>

    <div class="govuk-tabs" data-module="tabs">
        <h2 class="govuk-tabs__title">
          @Messages("client-authorised-agents.title")
        </h2>

        <ul class="govuk-tabs__list">
            @if(config.pendingRequestsExist) {
                <li class="govuk-tabs__list-item">
                    <a class="govuk-tabs__tab govuk-tabs__tab--selected" href="#currentRequests">
                    @Messages("client-authorised-agents-table-relationships.tab1.title")
                    </a>
                </li>
            }
            <li class="govuk-tabs__list-item">
                <a class="govuk-tabs__tab" href="#currentAuths">
                    @Messages("client-authorised-agents-table-relationships.tab2.title")
                </a>
            </li>
            <li class="govuk-tabs__list-item">
                <a class="govuk-tabs__tab" href="#history">
                    @Messages("client-authorised-agents-table-relationships.tab3.title")
                </a>
            </li>
        </ul>

        @if(config.pendingRequestsExist) {
        <section class="govuk-tabs__panel" id="currentRequests">
            <h2 class="margin-top-0">@Messages("client-authorised-agents-table-relationships.tab1.title")</h2>
            <p class="panel panel-border-wide">@config.pendingNo</p>
                <table class="font-small">
                    <colgroup>
                        <col width="55%">
                        <col width="25%">
                        <col width="20%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th scope="col">@Messages("client-authorised-agents-table.current.agentName")</th>
                            <th scope="col">@Messages("client-authorised-agents-table.current.expiryDate")</th>
                            <th scope="col" >@Messages("client-authorised-agents-table.current.action")</th>
                        </tr>
                    </thead>
                    <tbody>
                    @config.pendingRequests.map { agentReq =>
                        <tr>
                            <td>@agentReq.agencyName</td>
                            <td>@config.displayDate(Some(agentReq.expiryDate))</td>
                            <td >
                            @Html(Messages("client-authorised-agents-table.actions.respond", externalUrls.multiConfirmTermsUrl(agentReq.clientType, agentReq.uid)))
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            }

        </section>
        <section class="govuk-tabs__panel govuk-tabs__panel--hidden" id="currentAuths">
            <h2 class="margin-top-0">@Messages("client-authorised-agents-table-relationships.tab2.title")</h2>
            @if(config.authorisedAgentsExist){
                <p>@Messages("client-authorised-agents-table-relationships.tab2.p")</p>
                <table class="font-small">
                    <colgroup>
                        <col width="20%">
                        <col width="35%">
                        <col width="25%">
                        <col width="20%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th scope="col">@Messages("client-authorised-agents-table-row-header.agentName")</th>
                            <th scope="col">@Messages("client-authorised-agents-table-row-header.authServices")</th>
                            <th scope="col">@Messages("client-authorised-agents-table-row-header.dateAuthorised")</th>
                            <th scope="col" >@Messages("client-authorised-agents-table-row-header.actions")</th>
                        </tr>
                    </thead>
                    <tbody>
                        @config.authorisedAgents.map{ authAgent =>
                            <tr>
                                <td>@authAgent.agencyName</td>
                                <td>@Messages(s"client-authorised-agents-table-content.${authAgent.serviceName}")</td>
                                <td>@config.displayDate(authAgent.dateFrom)</td>
                                <td>@if(configuration.getBoolean(s"features.remove-authorisation.${authAgent.serviceName}").getOrElse(false) == true){<a href="@routes.ClientRelationshipManagementController.showRemoveAuthorisation(authAgent.serviceName, authAgent.uuId)">@Messages("client-authorised-agents-table-row-header.unauthoriseLink")</a>}</td>
                            </tr>
                        }
                    }else{
                <p>@Messages("client-authorised-agents-table-content.noAgentsFound")</p>
            }
        </tbody>
        </table>

        </section>
        <section class="govuk-tabs__panel govuk-tabs__panel--hidden" id="history">
            <h2 class="margin-top-0">@Messages("client-authorised-agents-table-relationships.tab3.title")</h2>
            @if(config.nonPendingRequestsExist){
                <p>@Messages("client-authorised-agents-table-relationships.tab3.p")</p>
                <table class="font-small">
                    <colgroup>
                        <col width="30%">
                        <col width="35%">
                        <col width="35%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th scope="col">@Messages("client-authorised-agents-table-row-header.agentName")</th>
                            <th scope="col">@Messages("client-authorised-agents-table-row-header.authRequested")</th>
                            <th scope="col">@Messages("client-authorised-agents-table-row-header.status")</th>
                        </tr>
                    </thead>
                    <tbody>

                        @config.nonPendingRequests.map { agentReq =>
                            <tr>
                                <td>@agentReq.agencyName</td>
                                <td>@Messages(s"client-authorised-agents-table-content.${agentReq.serviceName}")</td>
                                <td>@Messages(s"client-authorised-agents-table.${agentReq.status}")<span class="date-hint">
                                @config.displayDate(Some(agentReq.lastUpdated.toLocalDate))</span></td>
                                </td>
                            </tr>
                        }

                    }else{
                <p>@Messages("client-authorised-agents-table-content.no-activity")</p>
            }
        </tbody>
        </table>

        </section>
    </div>

}
